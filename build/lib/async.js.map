{
  "version": 3,
  "sources": ["../../src/lib/async.ts"],
  "sourcesContent": ["import { AtlasScientificEzoI2cAdapter } from \"../main\";\r\n\r\nexport class Delay {\r\n    private started = false;\r\n    private cancelled = false;\r\n    private timeout?: any;\r\n\r\n    private reject?: (reason?: any) => void;\r\n\r\n    constructor(private ms: number, protected readonly adapter: AtlasScientificEzoI2cAdapter) {}\r\n\r\n    public runAsnyc(): Promise<void> {\r\n        if (this.started) {\r\n            throw new Error(`Can't run delay twice!`);\r\n        }\r\n        this.started = true;\r\n        return new Promise((resolve, reject) => {\r\n            if (this.cancelled) {\r\n                return;\r\n            }\r\n            this.reject = reject;\r\n            this.timeout = this.adapter.setTimeout(resolve, this.ms);\r\n        });\r\n    }\r\n\r\n    public cancel(): void {\r\n        if (!this.started || this.cancelled) {\r\n            return;\r\n        }\r\n\r\n        this.cancelled = true;\r\n        if (this.timeout) {\r\n            this.adapter.clearTimeout(this.timeout);\r\n        }\r\n        if (this.reject) {\r\n            this.reject(new Error('Cancelled'));\r\n        }\r\n    }\r\n}\r\n\r\nexport type PollingCallback = () => Promise<void>;\r\n\r\nexport class Polling {\r\n    private enabled = false;\r\n    private delay?: Delay;\r\n\r\n    constructor(private callback: PollingCallback, protected readonly adapter: AtlasScientificEzoI2cAdapter) {}\r\n\r\n    async runAsync(interval: number, minInterval?: number): Promise<void> {\r\n        if (this.enabled) {\r\n            return;\r\n        }\r\n\r\n        this.enabled = true;\r\n        interval = Math.max(interval, minInterval || 1);\r\n        while (this.enabled) {\r\n            await this.callback();\r\n            try {\r\n                this.delay = new Delay(interval, this.adapter);\r\n                await this.delay.runAsnyc();\r\n            } catch (error) {\r\n                // delay got cancelled, let's break out of the loop\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    stop(): void {\r\n        this.enabled = false;\r\n        this.delay?.cancel();\r\n    }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEO,MAAM,MAAM;AAAA,EAOf,YAAoB,IAA+B,SAAuC;AAAtE;AAA+B;AANnD,SAAQ,UAAU;AAClB,SAAQ,YAAY;AAAA,EAKuE;AAAA,EAEpF,WAA0B;AAC7B,QAAI,KAAK,SAAS;AACd,YAAM,IAAI,MAAM,wBAAwB;AAAA,IAC5C;AACA,SAAK,UAAU;AACf,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACpC,UAAI,KAAK,WAAW;AAChB;AAAA,MACJ;AACA,WAAK,SAAS;AACd,WAAK,UAAU,KAAK,QAAQ,WAAW,SAAS,KAAK,EAAE;AAAA,IAC3D,CAAC;AAAA,EACL;AAAA,EAEO,SAAe;AAClB,QAAI,CAAC,KAAK,WAAW,KAAK,WAAW;AACjC;AAAA,IACJ;AAEA,SAAK,YAAY;AACjB,QAAI,KAAK,SAAS;AACd,WAAK,QAAQ,aAAa,KAAK,OAAO;AAAA,IAC1C;AACA,QAAI,KAAK,QAAQ;AACb,WAAK,OAAO,IAAI,MAAM,WAAW,CAAC;AAAA,IACtC;AAAA,EACJ;AACJ;AAIO,MAAM,QAAQ;AAAA,EAIjB,YAAoB,UAA8C,SAAuC;AAArF;AAA8C;AAHlE,SAAQ,UAAU;AAAA,EAGwF;AAAA,EAE1G,MAAM,SAAS,UAAkB,aAAqC;AAClE,QAAI,KAAK,SAAS;AACd;AAAA,IACJ;AAEA,SAAK,UAAU;AACf,eAAW,KAAK,IAAI,UAAU,eAAe,CAAC;AAC9C,WAAO,KAAK,SAAS;AACjB,YAAM,KAAK,SAAS;AACpB,UAAI;AACA,aAAK,QAAQ,IAAI,MAAM,UAAU,KAAK,OAAO;AAC7C,cAAM,KAAK,MAAM,SAAS;AAAA,MAC9B,SAAS,OAAP;AAEE;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAAA,EAEA,OAAa;AAnEjB;AAoEQ,SAAK,UAAU;AACf,eAAK,UAAL,mBAAY;AAAA,EAChB;AACJ;",
  "names": []
}
